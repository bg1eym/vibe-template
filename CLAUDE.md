IMPORTANT: Read docs/CURSOR_CONTRACT.md before changes. Run `npm run fmt && ./scripts/check-all.sh` at task end.

READ docs/SPEC.md before any change.
DO NOT implement anything outside SPEC.
DO NOT modify unrelated code.
Keep changes small and reviewable.
No large refactors unless requested.
Do not add dependencies without justification.
Every feature requires tests.
Every bug fix requires a regression test.
Update docs if behavior changes.
Record important decisions in docs/DECISIONS.md.

Always respond with:
Plan
Implementation
Tests
Notes/Risks
